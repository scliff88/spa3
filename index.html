<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solar Pre-Approval Application</title>
  <style>
    :root{
      --brand:#667eea; --brand2:#764ba2; --ink:#333;
      --ok:#16a34a; --warn:#b45309; --err:#b91c1c;
    }
    body{
      font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,Arial,sans-serif;
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand2) 100%);
      margin:0; padding:24px; display:flex; align-items:center; justify-content:center; min-height:100vh;
    }
    .container{background:#fff;border-radius:14px;box-shadow:0 14px 28px rgba(0,0,0,.12);width:100%;max-width:860px;padding:32px}
    .section{margin-top:28px}
    .section-header{color:var(--brand);border-bottom:2px solid var(--brand);padding-bottom:8px;margin-bottom:14px}
    label{font-weight:600;display:block;margin:10px 0 6px}
    input[type="text"],input[type="number"]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #cbd5e1}
    .inline{display:flex;align-items:center;gap:8px}
    .sub-options{background:#f8f9ff;border:1px dashed #dbeafe;padding:14px;border-radius:10px;margin-top:10px}
    .total{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff;text-align:center;padding:16px;border-radius:10px;font-weight:700;margin:18px 0}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="container">
    <h1>Solar Pre-Approval Application</h1>

    <!-- NMI -->
    <div class="section">
      <label for="nmi">Enter your NMI</label>
      <input id="nmi" type="text" placeholder="11-character NMI" />
      <p id="nmiError" class="hidden" style="color:#b91c1c">Invalid NMI.</p>
    </div>

    <!-- Property card -->
    <div id="propertyArea" class="hidden">
      <p><strong>✅ Property Found</strong></p>
      <p>Current Approved Capacity: <span id="approvedAC">–</span></p>
    </div>

    <!-- Installation -->
    <div id="installArea" class="section hidden">
      <h2 class="section-header">Installation Details</h2>

      <!-- inverter -->
      <div class="inline"><input id="chkInverter" type="checkbox"> <span>Solar inverter</span></div>
      <div id="inverterBox" class="sub-options hidden">
        <div class="inline"><input id="invAdd" type="checkbox"><span>Adding inverter</span></div>
        <div id="invAddBox" class="sub-options hidden">
          <label>Additional inverter (kW)</label>
          <input id="invAddKw" type="number" step="0.1">
        </div>
        <div class="inline"><input id="invReplace" type="checkbox"><span>Replacing inverter</span></div>
        <div id="invReplaceBox" class="sub-options hidden">
          <label>Removed AC (kW)</label>
          <input id="invRemoveKw" type="number" step="0.1">
          <label>Installed AC (kW)</label>
          <input id="invNewKw" type="number" step="0.1">
        </div>
      </div>

      <!-- battery -->
      <div class="inline" style="margin-top:8px"><input id="chkBattery" type="checkbox"><span>Battery</span></div>
      <div id="batteryBox" class="sub-options hidden">
        <div class="inline"><input type="radio" name="batType" id="batDC"><span>DC-coupled</span></div>
        <div class="inline"><input type="radio" name="batType" id="batAC"><span>AC-coupled</span></div>

        <div id="batACBox" class="sub-options hidden">
          <div class="inline"><input id="batAdd" type="checkbox"><span>Adding AC battery</span></div>
          <div id="batAddBox" class="sub-options hidden">
            <label>Battery AC (kW)</label>
            <input id="batAddKw" type="number" step="0.1">
          </div>
          <div class="inline"><input id="batReplace" type="checkbox"><span>Replacing AC battery</span></div>
          <div id="batReplaceBox" class="sub-options hidden">
            <label>Removed AC (kW)</label>
            <input id="batRemoveKw" type="number" step="0.1">
            <label>Installed AC (kW)</label>
            <input id="batNewKw" type="number" step="0.1">
          </div>
        </div>
      </div>

      <div class="total">New Total Proposed AC Capacity: <span id="totalCapacity2">0.0</span> kW</div>
    </div>
  </div>

  <script>
    let baseAC = 0, proposedAC = 0;
    const byId = id => document.getElementById(id);

    // --- show property when NMI length = 11 ---
    byId('nmi').addEventListener('input', e => {
      if(e.target.value.trim().length === 11){
        baseAC = 5.0; // demo base
        byId('approvedAC').textContent = baseAC.toFixed(1)+" kW";
        byId('propertyArea').classList.remove('hidden');
        byId('installArea').classList.remove('hidden');
        calcAndRender();
      }
    });

    // --- toggle helpers ---
    function bindToggle(chk, box){
      byId(chk).addEventListener('change', ()=>{
        byId(box).classList.toggle('hidden', !byId(chk).checked);
        calcAndRender();
      });
    }
    bindToggle('chkInverter','inverterBox');
    bindToggle('invAdd','invAddBox');
    bindToggle('invReplace','invReplaceBox');
    bindToggle('chkBattery','batteryBox');
    bindToggle('batAdd','batAddBox');
    bindToggle('batReplace','batReplaceBox');

    // battery type radios
    function showBatType(){
      byId('batACBox').classList.toggle('hidden', !byId('batAC').checked);
      calcAndRender();
    }
    ['batAC','batDC'].forEach(id=>byId(id).addEventListener('change',showBatType));

    // all inputs recalc on typing
    ['invAddKw','invRemoveKw','invNewKw','batAddKw','batRemoveKw','batNewKw']
      .forEach(id => byId(id).addEventListener('input', calcAndRender));

    // --- calc logic ---
    function calcApprovedCapacity(){
      let total = baseAC;

      // inverter
      if(byId('chkInverter').checked){
        if(byId('invAdd').checked){ total += +byId('invAddKw').value||0; }
        if(byId('invReplace').checked){
          total = total - (+byId('invRemoveKw').value||0) + (+byId('invNewKw').value||0);
        }
      }

      // battery
      if(byId('chkBattery').checked && byId('batAC').checked){
        if(byId('batAdd').checked){ total += +byId('batAddKw').value||0; }
        if(byId('batReplace').checked){
          total = total - (+byId('batRemoveKw').value||0) + (+byId('batNewKw').value||0);
        }
      }

      return Math.max(0,total);
    }

    function calcAndRender(){
      proposedAC = calcApprovedCapacity();
      byId('totalCapacity2').textContent = proposedAC.toFixed(1);
    }
  </script>
</body>
</html>
